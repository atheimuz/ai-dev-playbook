---
title: "셀프 개선 & 자동화 시스템 — 회고 루프부터 자동화 후보 탐지까지"
description: "/retrospective로 CLAUDE.md를 자동 개선하는 회고 루프, 2-failure 규칙, PreToolUse 훅, 자동화 방식 비교"
category: "개선"
tags: ["claude-code", "회고", "자동화", "CLAUDE.md", "훅", "셀프개선"]
date: "2026-02-17"
---

Claude Code를 잘 쓰려면 도구 자체를 계속 개선해야 한다는 걸 뒤늦게 깨달았다.
처음엔 같은 실수를 반복하고 있었다.
`/retrospective`를 만들고 나서 그 반복이 줄기 시작했다.

## 셀프 개선 루프

```
세션 진행
  ↓
같은 파일 반복 수정, 사용자 교정, 패턴 불일치 발생
  ↓
/retrospective 실행
  ↓
학습 항목 도출 (L-001, L-002...)
  ↓
CLAUDE.md / 에이전트 / 스킬 업데이트
  ↓
다음 세션에서 적용
```

핵심은 **문제가 두 번 발생하지 않게 하는 것**이다.
한번 겪은 문제를 CLAUDE.md에 규칙으로 남기면, 다음 세션부터는 Claude가 자동으로 따른다.

## /retrospective 6단계

**1단계: 세션 컨텍스트 분석**

현재 세션에서 발생한 문제를 추출한다:

- 같은 파일을 3회 이상 수정한 경우
- 사용자가 직접 교정한 부분
- 테스트 실패 후 패턴을 바꿔서 통과시킨 사례
- 동일한 명령어를 2회 이상 반복 수행한 패턴

**2단계: 7개 카테고리 분류**

| 카테고리               | 적용 대상         |
| ---------------------- | ----------------- |
| `pattern-mismatch`     | CLAUDE.md         |
| `missing-rule`         | CLAUDE.md         |
| `agent-gap`            | 에이전트 프롬프트 |
| `skill-gap`            | 스킬 프롬프트     |
| `automation-candidate` | 새 스킬/훅        |
| `test-convention`      | CLAUDE.md         |
| `workflow-friction`    | 전체              |

**3단계: 학습 항목 구조화**

```markdown
### L-001: cn() 유틸 미사용

- **카테고리**: pattern-mismatch
- **발견 경위**: Button 컴포넌트에서 className을 직접 조합
- **제안 변경**: CLAUDE.md에 "className 조합 시 cn() 유틸 사용" 규칙 추가
- **근거**: 같은 세션에서 3번 수동 교정함
```

**4단계: 변경 제안서**

"전체 적용 / 선택 적용 / 수정 후 적용 / 건너뛰기" 중 선택한다.

**5단계: 승인 후 적용**

승인된 항목만 실제 파일에 반영한다.

**6단계: 결과 확인**

변경된 파일 목록 확인, diff 보기, 커밋 선택.

**설계 제약:** 서브에이전트를 쓰지 않는다.
대화 컨텍스트 분석이 핵심이라 메인에서 직접 실행해야 한다.

## 실제 회고 사례

**사례 1: handle/on 네이밍 규칙**

이벤트 핸들러를 `handleClick`, `clickHandler`, `onClick`으로 일관성 없이 쓰고 있었다.
3번 수동 교정 후 `/retrospective` 실행.

```
L-003: 이벤트 핸들러 네이밍 불일치
→ CLAUDE.md에 추가: "내부 핸들러는 handle<Action>, props는 on<Action>"
```

이후 세션부터 Claude가 자동으로 따랐다.

**사례 2: 서브에이전트 컨텍스트 단절**

구현 에이전트가 기존 컴포넌트를 무시하고 새로 만들어버렸다.

```
L-005: 구현 에이전트가 기존 컴포넌트 미참조
→ agent-gap으로 분류
→ code-analyst 에이전트 추가
```

이 한 번의 회고로 code-analyst가 파이프라인에 추가됐다.

## 2-failure 규칙

같은 접근법으로 2번 실패하면 즉시 접근법을 전환하는 규칙이다.

```
시도 1: 파일 A의 함수 B 수정 → 실패
시도 2: 같은 파일 A의 함수 B를 다르게 수정 → 실패
→ 전환: Playwright로 현재 동작을 진단하는 테스트 작성
→ 실제 동작 확인 후 새로운 접근법 시도
```

Claude는 "비슷한 방법을 약간 바꿔서 재시도"하는 경향이 있다.
이 규칙 없이는 같은 파일의 같은 함수를 5~6번 수정하는 경우가 생긴다.
CLAUDE.md에 이 규칙을 넣으면 3회 이상 같은 접근법을 반복하지 않는다.

## PreToolUse 훅

Task tool 호출 전에 CLAUDE.md를 에이전트 프롬프트에 자동 주입한다.

```json
{
    "hooks": {
        "PreToolUse": [
            {
                "matcher": "Task",
                "hook": "inject-claude-md.sh"
            }
        ]
    }
}
```

서브에이전트는 메인 대화를 볼 수 없다.
이 훅으로 CLAUDE.md 규칙을 자동으로 알게 된다.

## 자동화 후보 탐지 원칙

2회 이상 반복된 것만 자동화 후보로 올린다.
한 번 본 걸로 자동화하면 과잉 자동화가 된다.

## 4가지 자동화 방식 비교

| 방식               | 적합한 상황                   | 예시                                  |
| ------------------ | ----------------------------- | ------------------------------------- |
| **새 스킬**        | 복잡한 워크플로우, 인터랙티브 | `/retrospective`, `/session-analyzer` |
| **Hook**           | 도구 호출 전후 자동 실행      | PreToolUse로 CLAUDE.md 주입           |
| **스크립트**       | AI가 필요없는 단순 반복 명령  | `sync.sh`                             |
| **기존 스킬 확장** | 현재 워크플로우에 단계 추가   | `/feature`에 UX 단계 추가             |

선택 기준:

- 인터랙션이 필요하면 → 스킬
- 자동으로 실행되어야 하면 → 훅
- CLI에서 직접 실행하면 → 스크립트
- 기존 워크플로우 확장이면 → 기존 스킬 수정

## CLAUDE.md를 계속 보완해야 하는 이유

CLAUDE.md를 한 번 작성하고 끝내면 금방 쓸모없어진다.
계속 보완해야 하는 이유가 있다.

**프로젝트가 변하기 때문이다.**
파일이 많아지면 폴더 구조가 바뀌고, 네이밍 규칙도 달라진다.
처음에 정한 규칙이 현재 코드베이스와 맞지 않으면 Claude는 엉뚱한 패턴을 따른다.

**실제 문제는 사용해봐야 드러나기 때문이다.**
"컴포넌트는 단일 책임 원칙을 따른다"라고 써둬도 Claude는 이를 무시할 수 있다.
"하나의 컴포넌트에 useState 3개 이상이면 커스텀 훅으로 분리"처럼 구체적으로 바꿔야 따른다.
어떤 규칙이 너무 모호한지는 직접 겪어봐야 안다.

**규칙 간 충돌이 생기기 때문이다.**
"재사용 가능하게 만들어라"와 "과도한 추상화를 피해라"가 동시에 있으면 Claude는 혼란스러워한다.
한쪽을 우선으로 명시하거나, 적용 조건을 구체화해야 한다.

규칙이 늘어나면 비대해지는 문제도 생긴다:

- 폴더별 CLAUDE.md로 분리해서 스코프를 좁히기
- 더 이상 유효하지 않은 규칙 정기적으로 삭제
- 중복 규칙 병합

## 돌아보며

셀프 개선 시스템에서 가장 가치 있는 부분은 CLAUDE.md가 시간이 지날수록 정교해진다는 점이다.
처음에는 Claude가 같은 실수를 반복했다.
지금은 규칙이 쌓이면서 그 실수가 많이 줄었다.

도구를 쓰는 것보다 도구를 쓰는 방식을 계속 개선하는 게 더 중요하다.
